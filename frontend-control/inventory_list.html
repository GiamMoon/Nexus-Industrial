<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Inventario | JHIRE Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <div class="d-flex" id="wrapper">
        <div class="bg-dark text-white border-end border-secondary" id="sidebar-wrapper">
            <div class="sidebar-heading border-bottom border-secondary bg-dark fw-bold text-info p-3">
                <i class="bi bi-cpu-fill"></i> JHIRE AI
            </div>
            <div class="list-group list-group-flush">
                <a href="index.html" class="list-group-item list-group-item-action list-group-item-dark"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
                <a href="inventory_list.html" class="list-group-item list-group-item-action list-group-item-dark active"><i class="bi bi-box-seam me-2"></i> Inventario</a>
                <a href="inventory.html" class="list-group-item list-group-item-action list-group-item-dark"><i class="bi bi-qr-code-scan me-2"></i> Escáner AR</a>
                <a href="sales.html" class="list-group-item list-group-item-action list-group-item-dark"><i class="bi bi-receipt me-2"></i> Ventas</a>
            </div>
        </div>

        <div id="page-content-wrapper" class="w-100 bg-black text-white">
            <nav class="navbar navbar-dark bg-dark border-bottom border-secondary px-4 py-3">
                <h5 class="m-0 text-white"><i class="bi bi-table"></i> Maestro de Productos</h5>
                <button class="btn btn-success btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#newProductModal">
                    <i class="bi bi-plus-lg"></i> NUEVO PRODUCTO
                </button>
            </nav>

            <div class="container-fluid p-4">
                <div class="card bg-dark border-secondary mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label text-white-50">Buscar</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-secondary border-secondary text-white"><i class="bi bi-search"></i></span>
                                    <input type="text" id="search-inv" class="form-control bg-dark text-white border-secondary" placeholder="SKU o Nombre...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label text-white-50">Estado</label>
                                <select class="form-select bg-dark text-white border-secondary">
                                    <option value="all">Todos</option>
                                    <option value="low">Stock Bajo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card bg-dark border-secondary shadow">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle mb-0">
                            <thead>
                                <tr class="text-white-50 small text-uppercase">
                                    <th class="ps-4">Producto</th>
                                    <th>SKU</th>
                                    <th>Precio Base</th>
                                    <th>Stock</th>
                                    <th>Estado IA</th>
                                    <th class="text-end pe-4">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // SCRIPT INCRUSTADO PARA RAPIDEZ
        document.addEventListener('DOMContentLoaded', loadInventory);
        
        async function loadInventory() {
            const tbody = document.getElementById('inventory-body');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center py-4">Cargando datos...</td></tr>';
            
            try {
                // Reutilizamos el endpoint público por ahora (En prod sería uno privado con paginación)
                const res = await fetch(`${API_URL}/api/market/productos`);
                const productos = await res.json();
                
                let html = "";
                productos.forEach(p => {
                    // Semáforo de Stock
                    let stockBadge = 'bg-success';
                    if(p.stock_disponible < 10) stockBadge = 'bg-danger animate-pulse';
                    else if(p.stock_disponible < 30) stockBadge = 'bg-warning text-dark';

                    html += `
                        <tr>
                            <td class="ps-4">
                                <div class="d-flex align-items-center">
                                    <img src="${p.imagen_url}" class="rounded me-3" width="40" height="40" style="object-fit:cover" onerror="this.src='https://via.placeholder.com/40'">
                                    <div>
                                        <div class="fw-bold">${p.nombre}</div>
                                        <div class="small text-white-50 text-truncate" style="max-width: 200px;">${p.descripcion}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="font-monospace small text-info">${p.sku}</td>
                            <td>S/ ${p.precio_lista.toFixed(2)}</td>
                            <td><span class="badge ${stockBadge} rounded-pill">${p.stock_disponible} und.</span></td>
                            <td>
                                ${p.es_oferta_ia ? '<span class="badge bg-primary"><i class="bi bi-lightning"></i> Dinámico</span>' : '<span class="badge bg-secondary">Normal</span>'}
                            </td>
                            <td class="text-end pe-4">
                                <button class="btn btn-sm btn-outline-light" onclick="editarProducto('${p.id}')"><i class="bi bi-pencil"></i></button>
                            </td>
                        </tr>
                    `;
                });
                tbody.innerHTML = html;
            } catch (e) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error cargando inventario</td></tr>';
            }
        }
    </script>
</body>
</html>