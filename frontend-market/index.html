<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS MARKET | Suministros Industriales</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="#">
                <i class="bi bi-cpu-fill text-info me-2"></i> NEXUS AI
            </a>
            
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-outline-light position-relative border-0" onclick="toggleCart()">
                    <i class="bi bi-cart3 fs-5"></i>
                    <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                </button>
                
                <div id="user-area" class="d-flex gap-2">
                    <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal">
                        Registrarse
                    </button>
                    <button class="btn btn-primary btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#loginModal">
                        <i class="bi bi-person-circle me-1"></i> Entrar
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <header class="hero-section text-center py-5 text-white position-relative overflow-hidden" style="background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);">
        <div class="position-absolute top-0 start-0 w-100 h-100" style="background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); opacity: 0.1;"></div>
        
        <div class="container position-relative" style="z-index: 2;">
            <h1 class="display-4 fw-bold mb-3">Suministros Inteligentes</h1>
            <p class="lead mb-4 text-white-50">Encuentra lo que necesitas, incluso si no sabes c√≥mo se llama.</p>
            
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="input-group input-group-lg shadow rounded-pill overflow-hidden">
                        <span class="input-group-text bg-white border-0 ps-4"><i class="bi bi-robot text-primary"></i></span>
                        <input type="text" id="search-input" class="form-control border-0" placeholder="Ej: 'Algo para limpiar grasa de motores heavy duty'...">
                        <button class="btn btn-info text-white fw-bold px-4" onclick="buscarProductos()">
                            BUSCAR CON IA
                        </button>
                    </div>
                    <small class="text-white-50 mt-3 d-block"><i class="bi bi-lightning-fill text-warning"></i> Powered by pgvector & OpenAI Embeddings</small>
                </div>
            </div>
        </div>
    </header>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
            <h3 class="fw-bold text-dark m-0"><i class="bi bi-tags-fill text-primary"></i> Cat√°logo</h3>
            <span class="badge bg-secondary"><i class="bi bi-clock-history"></i> Precios actualizados en tiempo real</span>
        </div>

        <div id="product-grid" class="row g-4">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2 text-muted">Conectando con el cerebro digital...</p>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title fw-bold">Acceso Clientes</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="login-form">
                        <div class="form-floating mb-3">
                            <input type="email" id="login-email" class="form-control" placeholder="nombre@empresa.com" required>
                            <label>Email Corporativo</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" id="login-pass" class="form-control" placeholder="Contrase√±a" required>
                            <label>Contrase√±a</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">Iniciar Sesi√≥n Segura</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-person-plus-fill"></i> Nuevo Cliente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="register-form">
                        <div class="row g-2 mb-2">
                            <div class="col-md-6">
                                <input type="text" id="reg-ruc" class="form-control" placeholder="RUC / DNI" required>
                            </div>
                            <div class="col-md-6">
                                <input type="text" id="reg-tel" class="form-control" placeholder="Celular" required>
                            </div>
                        </div>
                        <div class="mb-2">
                            <input type="text" id="reg-razon" class="form-control" placeholder="Raz√≥n Social / Nombre" required>
                        </div>
                        <div class="mb-2">
                            <input type="email" id="reg-email" class="form-control" placeholder="Email Corporativo" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" id="reg-pass" class="form-control" placeholder="Contrase√±a" required>
                        </div>
                        <button type="submit" class="btn btn-dark w-100 py-2">Crear Cuenta Empresarial</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="bi bi-basket2-fill"></i> Resumen de Pedido</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped mb-0 align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">Producto</th>
                                    <th>Precio Unit.</th>
                                    <th>Cantidad</th>
                                    <th class="text-end pe-4">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody id="cart-items-body">
                                </tbody>
                        </table>
                    </div>
                    <div class="p-4 bg-light d-flex justify-content-end align-items-center border-top">
                        <span class="text-muted me-3">Total a Pagar (Inc. IGV):</span>
                        <h3 class="fw-bold text-dark m-0">S/ <span id="cart-total">0.00</span></h3>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Seguir Comprando</button>
                    <button class="btn btn-success fw-bold px-4" onclick="procesarCheckout()">
                        <i class="bi bi-wallet2"></i> PAGAR AHORA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="chat-widget" style="position: fixed; bottom: 30px; right: 30px; z-index: 9999;">
        <button onclick="toggleChat()" class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center position-relative" style="width: 65px; height: 65px; border: 4px solid white;">
            <i class="bi bi-robot fs-3"></i>
            <span class="position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle">
                <span class="visually-hidden">Online</span>
            </span>
        </button>

        <div id="chat-window" class="card shadow-lg d-none border-0 overflow-hidden" style="position: absolute; bottom: 85px; right: 0; width: 350px; height: 500px; border-radius: 15px;">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-3">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-cpu-fill fs-4"></i>
                    <div class="d-flex flex-column" style="line-height: 1;">
                        <span class="fw-bold">Asistente T√©cnico</span>
                        <small style="font-size: 0.7rem; opacity: 0.8;">Powered by RAG</small>
                    </div>
                </div>
                <button onclick="toggleChat()" class="btn-close btn-close-white btn-sm"></button>
            </div>
            <div class="card-body bg-light overflow-auto d-flex flex-column gap-2" id="chat-body" style="font-size: 0.9rem;">
                <div class="text-center text-muted my-3">
                    <small>üëã Hola, puedo responder dudas t√©cnicas bas√°ndome en los manuales PDF cargados en el sistema.</small>
                </div>
            </div>
            <div class="card-footer bg-white p-2">
                <div class="input-group">
                    <input type="text" id="chat-input" class="form-control border-0 bg-light" placeholder="Escribe tu consulta aqu√≠..." onkeypress="if(event.key === 'Enter') enviarPreguntaIA()">
                    <button class="btn btn-primary rounded-end" onclick="enviarPreguntaIA()"><i class="bi bi-send-fill"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        // PWA Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</body>
</html>